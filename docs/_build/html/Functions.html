
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Functions module &#8212; Australian Farm Optimisation Model 0.0.1 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="module-Functions">
<span id="functions-module"></span><h1>Functions module<a class="headerlink" href="#module-Functions" title="Permalink to this headline">¶</a></h1>
<p>Created on Mon Nov 18 11:29:17 2019</p>
<p>module: functions module - contains all the core functions that we have made</p>
<p>Version Control:
Version     Date        Person  Change
1.1         10Dec19     John    xl_all_named_ranges: Commented the updates made</p>
<blockquote>
<div><p>removed cells temporary variable and parameters dict is updated directly from the cells read</p>
</div></blockquote>
<dl class="simple">
<dt>1.2         11Dec19     John    xl_all_named_ranges: Added handling of rangename errors. Pass over index errors that are associated with ‘bad’ range names</dt><dd><p>IndexError handles when a sheet with names has been deleted (ie a sheet_name error)
TypeError handles a name in the target sheet is #REF (ie a cell_range error)</p>
</dd>
</dl>
<p>1.3         12Dec19     MRY     phases: Altered the phase filter to compare the landuse in the following pairs (0,1),(1,2)…(len_phase-2,len_phase-1) so the first and last year are not compared
1.4         13Dec19     MRY     added cartesian_product_simple_transpose - a fast func for making every possibility of multiple lists
1.5         22Dec19     John    period_allocation: simplify the function so that it doesn’t redefine variable from the parameters passed</p>
<blockquote>
<div><p>range_allocation: added this function fashioned from period_allocation</p>
</div></blockquote>
<p>1.6         26Dec19     JMY     xl_all_named_ranges: altered 2 comments that were in the wrong position
1.7         19Jan20     MRY     altered cost period function to handle df with undefined title - because now inputs are read in from excel the column name can vary, which it couldn’t before because the df was built from dict hence column name was always 0</p>
<p>Known problems:
Fixed   Date    ID by   Problem</p>
<p>&#64;author: young</p>
<dl class="py function">
<dt id="Functions.cartesian_product_simple_transpose">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">cartesian_product_simple_transpose</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arrays</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.cartesian_product_simple_transpose" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="Functions.dmd_to_md">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">dmd_to_md</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dmd</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.dmd_to_md" title="Permalink to this definition">¶</a></dt>
<dd><p>define a function to return M/D from DMD</p>
<p>dmd can be either a percentage or a decimal
returns M/D in MJ of ME per kg of DM
dmd can be a numpy array or a scalar (not sure if it handles lists and data frames)</p>
<dl class="simple">
<dt>^ this could be expanded to include forage (0.172 * dmd - 1.7)</dt><dd><p>and supplement (.133 * dmd + 23.4 ee + 1.32)
using an extra ‘type’ input that is default ‘herbage’</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="Functions.f_baseyr">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_baseyr</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">periods</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_year</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_baseyr" title="Permalink to this definition">¶</a></dt>
<dd><p>convert all dates to the same year
:param periods: array of period dates
:param base_year: datetime[Y] - year to convert periods to. If None it takes the year from the first period in array.</p>
</dd></dl>

<dl class="py function">
<dt id="Functions.f_bilinear_interpolate">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_bilinear_interpolate</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_bilinear_interpolate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="Functions.f_clean_dict">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_clean_dict</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_clean_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Replace None values with 0 in a dict.</p>
</dd></dl>

<dl class="py function">
<dt id="Functions.f_convert_to_inf">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_convert_to_inf</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_convert_to_inf" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="Functions.f_divide">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_divide</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">numerator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">denominator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'float64'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">option</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_divide" title="Permalink to this definition">¶</a></dt>
<dd><p>Elementwise divides two arrays.
If the denominator = 0 then return value depends on ‘option’</p>
<blockquote>
<div><p>option == 0 then return 0
option == 1 then return 1 if the numerator is also 0</p>
<p>option == 1 will also return 1 if both the numerator and denominator are np.inf</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt id="Functions.f_effective_mei">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_effective_mei</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dmi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">md</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ri</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eff_above</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_effective_mei" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate MEI and scale for reduced efficiency if quality is above animal requirements.</p>
<p>dmi       : value or array - Dry matter intake (kg).
md        : value or array - M/D of the feed (MJ of ME / kg of DM).
threshold : value or array - Diet quality (ME/Vol) required by animals. Below the threshold: effective m/d == m/d
ri        : value or array, optional (1.0) - Relative intake (quality and quantity).
eff_above : value or array, optional (0.5) - Efficiency that energy is used if above required quality, and animals are gaining then losing weight.</p>
<p>If inputs are provided in arrays then they must be broadcastable.</p>
<p>ME available to the animal to meet their ME requirements, from the quantity of DM consumed.</p>
</dd></dl>

<dl class="py function">
<dt id="Functions.f_expand">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_expand</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">left_pos</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">swap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">right_pos</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">left_pos2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">right_pos2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">left_pos3</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">right_pos3</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">condition</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">swap2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax1_2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax2_2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">condition2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">condition3</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis3</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">left_pos4</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">right_pos4</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">move</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dest</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_expand" title="Permalink to this definition">¶</a></dt>
<dd><p><a href="#id1"><span class="problematic" id="id2">*</span></a>note: if adding two sets of new axis add from right to left (then the pos variables align)
<a href="#id3"><span class="problematic" id="id4">*</span></a>note: mask applied last (after expanding and reshaping)</p>
<dl class="simple">
<dt>array<span class="classifier">array</span></dt><dd><p>parameter array - input from excel.</p>
</dd>
<dt>left_pos<span class="classifier">int</span></dt><dd><p>position of axis to the left of where the new axis will be added.</p>
</dd>
<dt>swap<span class="classifier">boolean, optional</span></dt><dd><p>do you want to swap the first tow axis?. The default is False.</p>
</dd>
<dt>right_pos<span class="classifier">int, optional</span></dt><dd><p>the position of the axis to the right of the singleton axis being added. The default is -1, for when the axis to the right is g?.</p>
</dd>
<dt>left_pos2<span class="classifier">int</span></dt><dd><p>position of axis to the left of where the new axis will be added.</p>
</dd>
<dt>right_pos2<span class="classifier">int, optional</span></dt><dd><p>the position of the axis to the right of the singleton axis being added. The default is -1, for when the axis to the right is g?.</p>
</dd>
<dt>condition: boolean, optional</dt><dd><p>mask used to slice given axis.</p>
</dd>
<dt>axis: int, optional</dt><dd><p>axis to apply mask to.</p>
</dd>
</dl>
<p>expands, swaps axis if required and apply a mask to a given axis if required.</p>
</dd></dl>

<dl class="py function">
<dt id="Functions.f_find_closest">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_find_closest</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">A</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_find_closest" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="Functions.f_group_exp">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_group_exp</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">exp_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiment_trials</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_group_exp" title="Permalink to this definition">¶</a></dt>
<dd><p>Cuts exp based on the group passed in as argument by user. If no argument then all trials are run.</p>
</dd></dl>

<dl class="py function">
<dt id="Functions.f_produce_df">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_produce_df</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rows</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">columns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">column_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_produce_df" title="Permalink to this definition">¶</a></dt>
<dd><p>rows is a list of lists that will be used to build a MultiIndex
columns is a list of lists that will be used to build a MultiIndex</p>
</dd></dl>

<dl class="py function">
<dt id="Functions.f_read_exp">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_read_exp</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_read_exp" title="Permalink to this definition">¶</a></dt>
<dd><ol class="arabic simple">
<li><p>Read in exp.xl, set index and cols and drop un-required cols.</p></li>
<li><p>Determine which trials are in the experiment the user specified to run.</p></li>
</ol>
</dd></dl>

<dl class="py function">
<dt id="Functions.f_reduce_skipfew">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_reduce_skipfew</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ufunc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">foo</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">preserveAxis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_reduce_skipfew" title="Permalink to this definition">¶</a></dt>
<dd><p>performs function on each axis except the axis that a specified as preserveAxis</p>
</dd></dl>

<dl class="py function">
<dt id="Functions.f_run_required">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_run_required</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">exp_data1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_run_required" title="Permalink to this definition">¶</a></dt>
<dd><p>here we check if precalcs and pyomo need to be recalculated. this is slightly complicated by the fact that columns and rows can be added to exp.xls
and the fact that a user can opt not to run a trial even if it is out of date so the run requirement must be tracked
have any sa cols been added or removed, are the values the same, has the py code changed since last run?</p>
<p>this function is also used by report.py to calculate if reports are being generated with out of date data.</p>
</dd></dl>

<dl class="py function">
<dt id="Functions.f_sa">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_sa</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sa</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sa_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_min</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">inf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pandas</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_sa" title="Permalink to this definition">¶</a></dt>
<dd><p>applies SA. Function can handle numpy or pandas</p>
</dd></dl>

<dl class="py function">
<dt id="Functions.f_update">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_update</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">existing_value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask_for_new</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_update" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>existing_value<span class="classifier">numpy array or float or int</span></dt><dd><p>values you want when mask = false.</p>
</dd>
<dt>new_value<span class="classifier">numpy array or float or int</span></dt><dd><p>values you want when mask = true.</p>
</dd>
<dt>mask_for_new<span class="classifier">boolean mask</span></dt><dd><p>boolean mask for the final axis of the array (typically the g axis).</p>
</dd>
</dl>
<dl class="simple">
<dt>Numpy array</dt><dd><p>returns a combination of the two input arrays determined by the mask. Note: multiplying by true return the original number and multiplying by false results in 0.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="Functions.f_update_sen">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_update_sen</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">row</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exp_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sam</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saa</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sav</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_update_sen" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="Functions.f_weighted_average">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">f_weighted_average</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keepdims</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">non_zero</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">den_weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.f_weighted_average" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates weighted average (similar to np.average however this will handle if the sum of the weights is 0 (np.average doesnt handle this)
‘non-zero’ handles how the average is calculated
Note: if non-zero is false then when sum weights = 0 the numbers being averaged also = 0 (so can divide by 1 instead of 0)
The function is also called from the reporting module with den_weights. den_weights can be 0, in which case ‘non-zero’ handles how the average is calculated
axis averaged along can be retained - default it is dropped.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>array</strong> – </p></li>
<li><p><strong>weights</strong> – </p></li>
<li><p><strong>axis</strong> – </p></li>
<li><p><strong>keepdims</strong> – </p></li>
<li><p><strong>non_zero</strong> – how to handle a weight of 0. True returns the numerator, False (default) returns 0</p></li>
<li><p><strong>den_weights</strong> – array: broadcastable to weights. This is used to weight the denominator (used in reporting)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="Functions.findDiff">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">findDiff</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.findDiff" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="Functions.md_to_dmd">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">md_to_dmd</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">md</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.md_to_dmd" title="Permalink to this definition">¶</a></dt>
<dd><p>basically a rearranged version of the function above
returns dmd as a decimal</p>
</dd></dl>

<dl class="py function">
<dt id="Functions.period_allocation">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">period_allocation</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">period_dates</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periods</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.period_allocation" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>period_dates<span class="classifier">List</span></dt><dd><p>Dates of the periods you are matching within eg labour periods or cashflow periods
<a href="#id5"><span class="problematic" id="id6">*</span></a>note the start date of the period must added to the end of the period if length is passed in</p>
</dd>
<dt>periods<span class="classifier">List</span></dt><dd><p>Name of each period.</p>
</dd>
<dt>start_d<span class="classifier">Date</span></dt><dd><p>Date of interest.</p>
</dd>
<dt>length<span class="classifier">Dt, optional</span></dt><dd><p>Length of the period of interest. The default is ‘’.</p>
</dd>
</dl>
<p>Proportion of a given date range in each period:
Either take a date and returns the period it is in
or take a date and a length and return a dataframe with a proportion in each period</p>
</dd></dl>

<dl class="py function">
<dt id="Functions.period_allocation2">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">period_allocation2</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">length_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_dates</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.period_allocation2" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>start_df<span class="classifier">Datetime series</span></dt><dd><p>Contains the activity start dates ie start date of fert spreading for each fert.</p>
</dd>
<dt>length_df<span class="classifier">Datetime series</span></dt><dd><p>Length of the df activity ie length of fert spreading for each fert.</p>
</dd>
<dt>p_dates<span class="classifier">List</span></dt><dd><p>Dates of the period you are matching ie cashflow or labour. Includes the end date of the last period</p>
</dd>
<dt>p_name<span class="classifier">List</span></dt><dd><p>Names of the period you are matching ie cashflow or labour. Includes the a name for the last date which is not a period (it is just the end date of the last period)</p>
</dd>
</dl>
<dl class="simple">
<dt>Dataframe 2D</dt><dd><p>index = period names you are matching within ie cashflow
column names = activities ie fertilisers
This function is used when multiple activities have different period allocation.
- this func basically just calls the main allocation multiple times and adds the results to one df.
eg the cost of fert spreading could be in different periods depending what time of yr that fertiliser is applied</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="Functions.period_proportion_np">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">period_proportion_np</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">period_dates</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">date_array</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.period_proportion_np" title="Permalink to this definition">¶</a></dt>
<dd><p>Numpy version - The period that a given date falls in. and the proportion of the way through the period the date occurs.</p>
<p>Parameters.
period_dates: Numpy array np.datetime64</p>
<blockquote>
<div><p>The dates of the periods to search.
Must contain the end date of the last period.
If multi-D period axis must be pos 0.</p>
</div></blockquote>
<dl class="simple">
<dt>date_array: Numpy array np.datetime64</dt><dd><p>The dates to allocate.</p>
</dd>
</dl>
<p>Note: period_dates and date_array must be broadcastable.</p>
<p>Returns.
Two Numpy arrays with shape(date_array).</p>
<blockquote>
<div><p>1 period_array - the period which the values in date_array occur.
2 proportion_array - how far through the period the date occurs.</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt id="Functions.range_allocation_np">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">range_allocation_np</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">period_dates</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opposite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.range_allocation_np" title="Permalink to this definition">¶</a></dt>
<dd><p>Numpy version - The proportion of each period that falls in the tested date range or proportion of date range in each period.</p>
<p>Parameters.
period_dates: the start of the periods - in a Numpy array np.datetime64. This array must be broadcastable with start</p>
<blockquote>
<div><p>(therefore may need to add new axis if start has a dimension).</p>
</div></blockquote>
<p>start: the date of the beginning of the date range to test - a numpy array of dates (np.datetime64)
length: the length of the date range to test - an array of timedelta.</p>
<blockquote>
<div><p>: must be broadcastable into start.</p>
</div></blockquote>
<dl class="simple">
<dt>opposite: input True returns the proportion of date range in each period.</dt><dd><p>:       None returns the proportion of the period in the date range (2nd arg).</p>
</dd>
</dl>
<p>shape: this is the shape of returned array required if both period_dates &amp; start have more than 1 dim</p>
<p>Returns.
a Numpy array with shape(period_dates, start array).
Containing the proportion of the respective period for that test date.</p>
</dd></dl>

<dl class="py function">
<dt id="Functions.searchsort_multiple_dim">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">searchsort_multiple_dim</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis_a0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis_a1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis_v0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis_v1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">side</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'left'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.searchsort_multiple_dim" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the indices into a sorted array a such that, if the corresponding elements in ‘v’ were inserted before the indices, the order of ‘a’ would be preserved.
It does this iteratively down the specified axis (therefore the specified axis must be present in both ‘a’ and ‘v’</p>
<dl>
<dt>Parameters:</dt><dd><p>a: 3-D array_like
Input array. Must be sorted in ascending order.</p>
<p>v: array_like
Values to insert into a.</p>
<p>axis_a0: int
The position of axis to iterate along. a1 &amp; v1 axis must be same length
axis_a1: int
The position of axis to iterate along. a1 &amp; v1 axis must be same length</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="Functions.write_variablesummary">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">write_variablesummary</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exp_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">option</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.write_variablesummary" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> – pyomo model</p></li>
<li><p><strong>row</strong> – trial row</p></li>
<li><p><strong>exp_data</strong> – exp info</p></li>
<li><p><strong>obj</strong> – objective value</p></li>
<li><p><strong>option</strong> – 0: trial name will be included in file name
1: file name will be generic</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="Functions.xl_all_named_ranges">
<code class="sig-prename descclassname"><span class="pre">Functions.</span></code><code class="sig-name descname"><span class="pre">xl_all_named_ranges</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targetsheets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rangename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">numpy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datatype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Functions.xl_all_named_ranges" title="Permalink to this definition">¶</a></dt>
<dd><p>Read data from named ranges in an Excel workbook.</p>
<p>Parameters:
filename is an Excel workbook name (including the extension).
targetsheets is a list of (or a single) worksheet names from which to read the range names.
rangename is an optional argument. If not included then all rangenames are read. If included only that name is read in.
numpy is an optional boolean argument. If True it will assign the input array to a numpy
datatype: you can use this parameter to select the data type of the numpy arrays. if a value doesnt match the dtype it gets a nan</p>
<p>Returns:
A dictionary that includes key that correspond to the rangenames</p>
</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Australian Farm Optimisation Model</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_doc.html">General</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Michael Young & John Young.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/Functions.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>